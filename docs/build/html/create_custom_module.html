<!doctype html>
<html class="no-js" lang="en" data-content_root="">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Module function names" href="module_function_names.html" /><link rel="prev" title="Access data in RMarkdown" href="access_data_rmarkdown.html" />

    <!-- Generated with Sphinx 7.1.2 and Furo 2024.01.29 -->
        <title>Create custom module - Cecelia 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">Cecelia 0.1 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">Cecelia 0.1 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="missions.html">Missions</a></li>
<li class="toctree-l1"><a class="reference internal" href="access_data_rmarkdown.html">Access data in RMarkdown</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Create custom module</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_function_names.html">Module function names</a></li>
<li class="toctree-l1"><a class="reference internal" href="population_types.html">Population types</a></li>
<li class="toctree-l1"><a class="reference internal" href="input_widget_types.html">Input widget types</a></li>
<li class="toctree-l1"><a class="reference internal" href="others.html">Connecting other packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="create-custom-module">
<span id="id1"></span><h1>Create custom module<a class="headerlink" href="#create-custom-module" title="Permalink to this heading">#</a></h1>
<p>We can create custom <cite>modules</cite> and respective <cite>input definitions</cite> by creatting an <cite>R6</cite> class and a <cite>JSON</cite> file respectively. As an example we take the analysis from <a class="reference internal" href="access_data_rmarkdown.html#access-data-rmarkdown"><span class="std std-ref">Access data in RMarkdown</span></a>.</p>
<section id="live-cell-imaging">
<h2>Live cell imaging<a class="headerlink" href="#live-cell-imaging" title="Permalink to this heading">#</a></h2>
<section id="r-markdown">
<h3>R Markdown<a class="headerlink" href="#r-markdown" title="Permalink to this heading">#</a></h3>
<p>To start off, we can design the functionality we want as <cite>R Markdown</cite>. In this example we are modifying the way in which the angle and speed of cell tracks is calculated. By default, the angle for each object is defined by the previous two timepoints. That is, you will have three points and the two lines between those define the angle. You could increase the distance between these two lines and measure the angle between the first and last segment of a given track. This would give you a coarser measurement of the angle and could be used to classify behaviour differently. We will illustrate this by applying a Hidden Markov Model on these modified measurements.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Please complete the previous tutorial (<a class="reference internal" href="access_data_rmarkdown.html#access-data-rmarkdown"><span class="std std-ref">Access data in RMarkdown</span></a>) to follow the steps.</p>
</div>
<p>To calculate angles, we must get tracks. Tracks can be obtained by using their <cite>population</cite> (eg/ cell_typeA/tracked) or <cite>value</cite> (eg/ cell_typeA) names. A <cite>value</cite> name is the name of the segmentation that the populations are derived from, ie/ the filename for the segmentation.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># get value names from populations</span>
<span class="linenos">2</span><span class="n">valueNames</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sapply</span><span class="p">(</span><span class="n">pops</span><span class="p">,</span><span class="w"> </span><span class="n">.flowPopParent</span><span class="p">,</span><span class="w"> </span><span class="n">USE.NAMES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span>
<span class="linenos">3</span><span class="nf">names</span><span class="p">(</span><span class="n">valueNames</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">valueNames</span>
<span class="linenos">4</span>
<span class="linenos">5</span><span class="c1"># get tracks for populations</span>
<span class="linenos">6</span><span class="n">tracks</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lapply</span><span class="p">(</span><span class="n">valueNames</span><span class="p">,</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">cciaObj</span><span class="o">$</span><span class="nf">tracks</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="linenos">7</span><span class="n">tracks</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/create_module_tracks.png"><img alt="_images/create_module_tracks.png" src="_images/create_module_tracks.png" style="width: 100%;" /></a>
<p>To get the angle between the first and the last segment of a track we can use the <cite>overallAngle</cite> function from the <cite>celltrackR</cite> package. <cite>steps.subtracks</cite> defines the length of the sub segments that we can split the track up into. These segments are overlapping by default. You could pass  the argument <cite>steps.overlap = 0</cite> to make them non-overlapping. <cite>tracks.measure.fun</cite> is a convenience function from <cite>Cecelia</cite> to process tracks from multiple sources. In this case we have three cell types: OTI, gBT and P14.</p>
<p>We can call this convenience function which will generate another <cite>data-table</cite> of tracks with the given angle measurement. This <cite>tracks data-table</cite> can be merged to the original <cite>population data-table</cite> based on <cite>value name</cite>, <cite>track ID</cite> and <cite>cell ID</cite> (which is the cell number within a given track).</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># get cumulative change of direction for each track</span>
<span class="linenos"> 2</span><span class="n">sumLength</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">8</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="n">popDT</span><span class="p">[</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="nf">tracks.measure.fun</span><span class="p">(</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="n">tracks</span><span class="p">,</span><span class="w"> </span><span class="n">celltrackR</span><span class="o">::</span><span class="n">overallAngle</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;live.cell.sumChange&quot;</span><span class="p">,</span>
<span class="linenos"> 7</span><span class="w">    </span><span class="n">steps.subtracks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sumLength</span><span class="p">,</span><span class="w"> </span><span class="n">idcol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;value_name&quot;</span><span class="p">,</span>
<span class="linenos"> 8</span><span class="w">    </span><span class="n">increment.cell.id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span>
<span class="linenos"> 9</span><span class="w">  </span><span class="n">on</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">.</span><span class="p">(</span><span class="n">value_name</span><span class="p">,</span><span class="w"> </span><span class="n">track_id</span><span class="p">,</span><span class="w"> </span><span class="n">cell_id</span><span class="p">),</span>
<span class="linenos">10</span><span class="w">  </span><span class="n">live.cell.sumChange</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nf">.</span><span class="p">(</span><span class="n">live.cell.sumChange</span><span class="p">)</span>
<span class="linenos">11</span><span class="p">]</span>
</pre></div>
</div>
<p>We can the compare this modified angle with the default angle of a given track.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># plot out and compare</span>
<span class="linenos"> 2</span><span class="n">track_to_show</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">43</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="c1"># https://stackoverflow.com/a/21538521</span>
<span class="linenos"> 5</span><span class="n">myPalette</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">colorRampPalette</span><span class="p">(</span><span class="nf">rev</span><span class="p">(</span><span class="n">RColorBrewer</span><span class="o">::</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="m">11</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Spectral&quot;</span><span class="p">)))</span>
<span class="linenos"> 6</span><span class="n">sc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">scale_colour_gradientn</span><span class="p">(</span><span class="n">colours</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">myPalette</span><span class="p">(</span><span class="m">100</span><span class="p">),</span><span class="w"> </span><span class="n">limits</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">180</span><span class="p">),</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Angle (°)&quot;</span><span class="p">)</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="nf">ggplot</span><span class="p">(</span><span class="n">popDT</span><span class="p">[</span><span class="n">value_name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;P14&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">track_id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">track_to_show</span><span class="p">],</span>
<span class="linenos"> 9</span><span class="w">       </span><span class="nf">aes</span><span class="p">(</span><span class="n">centroid_x</span><span class="p">,</span><span class="w"> </span><span class="n">centroid_y</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">track_id</span><span class="p">,</span>
<span class="linenos">10</span><span class="w">           </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pracma</span><span class="o">::</span><span class="nf">rad2deg</span><span class="p">(</span><span class="n">live.cell.sumChange</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span>
<span class="linenos">11</span><span class="w">  </span><span class="nf">theme_classic</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="linenos">12</span><span class="w">  </span><span class="nf">geom_path</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="linenos">13</span><span class="w">  </span><span class="c1"># facet_grid(.~pop) +</span>
<span class="linenos">14</span><span class="w">  </span><span class="c1"># scale_color_brewer(palette = &quot;spectral&quot;, name = &quot;Sum (°)&quot;) +</span>
<span class="linenos">15</span><span class="w">  </span><span class="n">sc</span><span class="w"> </span><span class="o">+</span>
<span class="linenos">16</span><span class="w">  </span><span class="nf">ggtitle</span><span class="p">(</span><span class="s">&quot;Cumulative change&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="linenos">17</span><span class="w">  </span><span class="nf">coord_fixed</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="linenos">18</span><span class="w">  </span><span class="nf">theme</span><span class="p">(</span>
<span class="linenos">19</span><span class="w">    </span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span>
<span class="linenos">20</span><span class="w">    </span><span class="n">axis.ticks.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span>
<span class="linenos">21</span><span class="w">    </span><span class="n">axis.text.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span>
<span class="linenos">22</span><span class="w">    </span><span class="n">axis.ticks.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span>
<span class="linenos">23</span><span class="w">    </span><span class="n">axis.line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span>
<span class="linenos">24</span><span class="w">    </span><span class="n">axis.title.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span>
<span class="linenos">25</span><span class="w">    </span><span class="n">axis.title.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span>
<span class="linenos">26</span><span class="w">  </span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nf">ggplot</span><span class="p">(</span><span class="n">popDT</span><span class="p">[</span><span class="n">value_name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;P14&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">track_id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">track_to_show</span><span class="p">],</span>
<span class="linenos"> 2</span><span class="w">       </span><span class="nf">aes</span><span class="p">(</span><span class="n">centroid_x</span><span class="p">,</span><span class="w"> </span><span class="n">centroid_y</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">track_id</span><span class="p">,</span>
<span class="linenos"> 3</span><span class="w">           </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pracma</span><span class="o">::</span><span class="nf">rad2deg</span><span class="p">(</span><span class="n">live.cell.angle</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="nf">theme_classic</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="nf">geom_path</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="linenos"> 6</span><span class="w">  </span><span class="c1"># facet_grid(.~pop) +</span>
<span class="linenos"> 7</span><span class="w">  </span><span class="c1"># scale_color_brewer(palette = &quot;spectral&quot;, name = &quot;Angle (°)&quot;) +</span>
<span class="linenos"> 8</span><span class="w">  </span><span class="n">sc</span><span class="w"> </span><span class="o">+</span>
<span class="linenos"> 9</span><span class="w">  </span><span class="nf">ggtitle</span><span class="p">(</span><span class="s">&quot;Angle&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="linenos">10</span><span class="w">  </span><span class="nf">coord_fixed</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="linenos">11</span><span class="w">  </span><span class="nf">theme</span><span class="p">(</span>
<span class="linenos">12</span><span class="w">    </span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span>
<span class="linenos">13</span><span class="w">    </span><span class="n">axis.ticks.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span>
<span class="linenos">14</span><span class="w">    </span><span class="n">axis.text.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span>
<span class="linenos">15</span><span class="w">    </span><span class="n">axis.ticks.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span>
<span class="linenos">16</span><span class="w">    </span><span class="n">axis.line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span>
<span class="linenos">17</span><span class="w">    </span><span class="n">axis.title.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span>
<span class="linenos">18</span><span class="w">    </span><span class="n">axis.title.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span>
<span class="linenos">19</span><span class="w">  </span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/create_module_angle.png"><img alt="_images/create_module_angle.png" src="_images/create_module_angle.png" style="width: 48%;" /></a>
<a class="reference internal image-reference" href="_images/create_module_sumChange.png"><img alt="_images/create_module_sumChange.png" src="_images/create_module_sumChange.png" style="width: 48%;" /></a>
</section>
<section id="creating-a-module">
<h3>Creating a module<a class="headerlink" href="#creating-a-module" title="Permalink to this heading">#</a></h3>
<p>To look at this measurement, apply it to other images and to use it for other purposes it is easiest to create custom module. Every module is an <a class="reference external" href="https://r6.r-lib.org/articles/Introduction.html">R6</a> class. You can add this module to the GUI by providing an <cite>input definition</cite> that will be read by the <cite>Input manager</cite> and displayed on the defined modules page. Custom modules can be added to the base directory that you used to install <cite>Cecelia</cite>. Create a folder <cite>modules</cite> and the sub-folders <cite>sources</cite> and <cite>inputDefinitions</cite>. Every category in <cite>Cecelia</cite> is a module with a <cite>function name</cite>. You can find the categories and their function names here: <a class="reference internal" href="module_function_names.html#module-function-names"><span class="std std-ref">Module function names</span></a>.</p>
<p>In this case we will put the calculation of the modified angle into <cite>Cell Behaviour</cite>. Create a folder in <cite>sources</cite> and <cite>inputDefinitions</cite> named <cite>behaviourAnalysis</cite>. In the <cite>sources/behaviourAnalysis</cite> folder, crate a file named <cite>cumulativeChange.R</cite> and in the <cite>inputDefinitions/behaviourAnalysis</cite> a file named <cite>cumulativeChange.json</cite>.</p>
<a class="reference internal image-reference" href="_images/create_module_folders.png"><img alt="_images/create_module_folders.png" src="_images/create_module_folders.png" style="width: 100%;" /></a>
<p>The following is the <cite>backbone</cite> for every module function. The key parts are that the class name corresponds to the function name. The class inherits from the main module, in this case <cite>BehaviourAnalysis</cite>. The function can then be called with <cite>behaviourAnalysis.cumulativeChange</cite>. The main logic is in the <cite>run</cite> function. We will fill in this function step by step.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="n">CumulativeChange</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">R6</span><span class="o">::</span><span class="nf">R6Class</span><span class="p">(</span>
<span class="linenos"> 2</span><span class="w">  </span><span class="s">&quot;CumulativeChange&quot;</span><span class="p">,</span>
<span class="linenos"> 3</span><span class="w">  </span><span class="n">inherit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BehaviourAnalysis</span><span class="p">,</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="n">private</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span>
<span class="linenos"> 6</span><span class="w">  </span><span class="p">),</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="w">  </span><span class="n">public</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span>
<span class="linenos"> 9</span><span class="w">    </span><span class="c1"># function name</span>
<span class="linenos">10</span><span class="w">    </span><span class="n">funName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">11</span><span class="w">      </span><span class="nf">paste</span><span class="p">(</span>
<span class="linenos">12</span><span class="w">        </span><span class="n">super</span><span class="o">$</span><span class="nf">funName</span><span class="p">(),</span>
<span class="linenos">13</span><span class="w">        </span><span class="s">&quot;cumulativeChange&quot;</span><span class="p">,</span>
<span class="linenos">14</span><span class="w">        </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cecelia</span><span class="o">:::</span><span class="n">CCID_CLASS_SEP</span>
<span class="linenos">15</span><span class="w">      </span><span class="p">)</span>
<span class="linenos">16</span><span class="w">    </span><span class="p">},</span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="w">    </span><span class="c1"># run</span>
<span class="linenos">19</span><span class="w">    </span><span class="n">run</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">20</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">21</span><span class="w">  </span><span class="p">)</span>
<span class="linenos">22</span><span class="p">)</span>
</pre></div>
</div>
<p>Place all code that follows into the <cite>run</cite> function. Every task has a log file associated with it. This file will be located in the directory of the <cite>image</cite> or <cite>image set</cite> that the function is running on. <cite>self$initLog()</cite> initialises the logfile and <cite>self$writeLog()</cite> will write the output. Every task is run on an <cite>image</cite> or <cite>image set</cite>. We can work with this object by calling <cite>self$cciaTaskObject()</cite>. All parameters that are passed to the function call are available through <cite>self$funParams()</cite>. In this first section, we initialise the log, get the task object and get the function parameters.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">self</span><span class="o">$</span><span class="nf">initLog</span><span class="p">()</span>
<span class="linenos">2</span><span class="n">self</span><span class="o">$</span><span class="nf">writeLog</span><span class="p">(</span><span class="s">&quot;Calculate HMM for cells&quot;</span><span class="p">)</span>
<span class="linenos">3</span>
<span class="linenos">4</span><span class="c1"># get object</span>
<span class="linenos">5</span><span class="n">cciaObj</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">self</span><span class="o">$</span><span class="nf">cciaTaskObject</span><span class="p">()</span>
<span class="linenos">6</span>
<span class="linenos">7</span><span class="n">popType</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">self</span><span class="o">$</span><span class="nf">funParams</span><span class="p">()</span><span class="o">$</span><span class="n">popType</span>
<span class="linenos">8</span><span class="n">pops</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">self</span><span class="o">$</span><span class="nf">funParams</span><span class="p">()</span><span class="o">$</span><span class="n">pops</span>
</pre></div>
</div>
<p>To save the new measurement, we need the <cite>population data-table</cite>. We can retrieve this with <cite>cciaObj$popDT()</cite> and passing the population names and type. The population type (<a class="reference internal" href="population_types.html#population-types"><span class="std std-ref">Population types</span></a>) refers to the method how these were derived.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">self</span><span class="o">$</span><span class="nf">writeLog</span><span class="p">(</span><span class="s">&quot;Get population DT&quot;</span><span class="p">)</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="c1"># get labels for populations from images</span>
<span class="linenos">4</span><span class="c1"># must get the whole data.table to save values back to labels</span>
<span class="linenos">5</span><span class="n">popDT</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cciaObj</span><span class="o">$</span><span class="nf">popDT</span><span class="p">(</span>
<span class="linenos">6</span><span class="w">  </span><span class="n">popType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">popType</span><span class="p">,</span>
<span class="linenos">7</span><span class="w">  </span><span class="n">pops</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pops</span><span class="p">,</span>
<span class="linenos">8</span><span class="w">  </span><span class="n">includeFiltered</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span>
<span class="linenos">9</span><span class="p">)</span>
</pre></div>
</div>
<p>We can get the tracks by their population name, eg/ <cite>P14/tracked</cite>, or by their <cite>value name</cite>, eg/ <cite>P14</cite>. And then again apply the summary functions to extract the angle between the first and the last segment of the track segments. We can do the same quantification for <cite>speed</cite> of the cells, ie/ to consider the distance between points with a gap. This will also give us a more coarse expression of the cellular movement. This is the same logi as we have applied in the <cite>R Markdown</cite> example above.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># get value names for pops</span>
<span class="linenos"> 2</span><span class="n">valueNames</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sapply</span><span class="p">(</span><span class="n">pops</span><span class="p">,</span><span class="w"> </span><span class="n">.flowPopParent</span><span class="p">,</span><span class="w"> </span><span class="n">USE.NAMES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span>
<span class="linenos"> 3</span><span class="nf">names</span><span class="p">(</span><span class="n">valueNames</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">valueNames</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="c1"># get tracks for populations</span>
<span class="linenos"> 6</span><span class="n">tracks</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lapply</span><span class="p">(</span><span class="n">valueNames</span><span class="p">,</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">cciaObj</span><span class="o">$</span><span class="nf">tracks</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="c1"># get cumulative change of direction for each track</span>
<span class="linenos"> 9</span><span class="n">popDT</span><span class="p">[</span>
<span class="linenos">10</span><span class="w">  </span><span class="nf">tracks.measure.fun</span><span class="p">(</span>
<span class="linenos">11</span><span class="w">    </span><span class="n">tracks</span><span class="p">,</span><span class="w"> </span><span class="n">celltrackR</span><span class="o">::</span><span class="n">overallAngle</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;live.cell.sumDirChange&quot;</span><span class="p">,</span>
<span class="linenos">12</span><span class="w">    </span><span class="n">steps.subtracks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="o">$</span><span class="nf">funParams</span><span class="p">()</span><span class="o">$</span><span class="n">sumLength</span><span class="p">,</span><span class="w"> </span><span class="n">idcol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;value_name&quot;</span><span class="p">,</span>
<span class="linenos">13</span><span class="w">    </span><span class="n">increment.cell.id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span>
<span class="linenos">14</span><span class="w">  </span><span class="n">on</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">.</span><span class="p">(</span><span class="n">value_name</span><span class="p">,</span><span class="w"> </span><span class="n">track_id</span><span class="p">,</span><span class="w"> </span><span class="n">cell_id</span><span class="p">),</span>
<span class="linenos">15</span><span class="w">  </span><span class="n">live.cell.sumDirChange</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nf">.</span><span class="p">(</span><span class="n">live.cell.sumDirChange</span><span class="p">)</span>
<span class="linenos">16</span><span class="p">]</span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="c1"># get cumulative change of speed for each track</span>
<span class="linenos">19</span><span class="n">popDT</span><span class="p">[</span>
<span class="linenos">20</span><span class="w">  </span><span class="nf">tracks.measure.fun</span><span class="p">(</span>
<span class="linenos">21</span><span class="w">    </span><span class="n">tracks</span><span class="p">,</span><span class="w"> </span><span class="n">celltrackR</span><span class="o">::</span><span class="n">speed</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;live.cell.sumSpeedChange&quot;</span><span class="p">,</span>
<span class="linenos">22</span><span class="w">    </span><span class="n">steps.subtracks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="o">$</span><span class="nf">funParams</span><span class="p">()</span><span class="o">$</span><span class="n">sumLength</span><span class="p">,</span><span class="w"> </span><span class="n">idcol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;value_name&quot;</span><span class="p">,</span>
<span class="linenos">23</span><span class="w">    </span><span class="n">increment.cell.id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span>
<span class="linenos">24</span><span class="w">  </span><span class="n">on</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">.</span><span class="p">(</span><span class="n">value_name</span><span class="p">,</span><span class="w"> </span><span class="n">track_id</span><span class="p">,</span><span class="w"> </span><span class="n">cell_id</span><span class="p">),</span>
<span class="linenos">25</span><span class="w">  </span><span class="n">live.cell.sumSpeedChange</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nf">.</span><span class="p">(</span><span class="n">live.cell.sumSpeedChange</span><span class="p">)</span>
<span class="linenos">26</span><span class="p">]</span>
</pre></div>
</div>
<p>We now must save these measurements back to the original labels data. Every segmentation is a different labels file. We must therefore go through the individual <cite>value names</cite> separately. <cite>cciaObj$labelProps()</cite> will give us the labels as a <cite>View on Anndata</cite>. This is a python class called <cite>LabelPropsView</cite> that has convenience functions to work with <cite>Anndata</cite> in the context of this package. We can merge the measurements to the existing labels and then use <cite>labels$add_obs()</cite> to add these back as a list. <cite>labels$save()</cite> will save the labels and the measurements are now available to view in napari and can be used for further processing.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># go through value names</span>
<span class="linenos"> 2</span><span class="nf">for </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="nf">unique</span><span class="p">(</span><span class="n">popDT</span><span class="o">$</span><span class="n">value_name</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 3</span><span class="w">  </span><span class="n">self</span><span class="o">$</span><span class="nf">writeLog</span><span class="p">(</span><span class="nf">sprintf</span><span class="p">(</span><span class="s">&quot;&gt; %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">))</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="c1"># save back to labels</span>
<span class="linenos"> 6</span><span class="w">  </span><span class="n">labels</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cciaObj</span><span class="o">$</span><span class="nf">labelProps</span><span class="p">(</span><span class="n">valueName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="p">)</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="w">  </span><span class="c1"># merge to existing labels</span>
<span class="linenos"> 9</span><span class="w">  </span><span class="n">mergedDT</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">popDT</span><span class="p">[</span><span class="n">value_name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span>
<span class="linenos">10</span><span class="w">    </span><span class="s">&quot;track_id&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cell_id&quot;</span><span class="p">,</span>
<span class="linenos">11</span><span class="w">    </span><span class="s">&quot;live.cell.sumDirChange&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;live.cell.sumSpeedChange&quot;</span>
<span class="linenos">12</span><span class="w">  </span><span class="p">)][</span>
<span class="linenos">13</span><span class="w">    </span><span class="nf">as.data.table</span><span class="p">(</span><span class="n">labels</span><span class="o">$</span><span class="nf">values_obs</span><span class="p">()),</span>
<span class="linenos">14</span><span class="w">    </span><span class="n">on</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">.</span><span class="p">(</span><span class="n">track_id</span><span class="p">,</span><span class="w"> </span><span class="n">cell_id</span><span class="p">)</span>
<span class="linenos">15</span><span class="w">  </span><span class="p">]</span>
<span class="linenos">16</span>
<span class="linenos">17</span><span class="w">  </span><span class="c1"># push back to labels</span>
<span class="linenos">18</span><span class="w">  </span><span class="n">labels</span><span class="o">$</span><span class="nf">add_obs</span><span class="p">(</span>
<span class="linenos">19</span><span class="w">    </span><span class="nf">as.list</span><span class="p">(</span><span class="n">mergedDT</span><span class="p">[,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;live.cell.sumDirChange&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;live.cell.sumSpeedChange&quot;</span><span class="p">)])</span>
<span class="linenos">20</span><span class="w">  </span><span class="p">)</span>
<span class="linenos">21</span>
<span class="linenos">22</span><span class="w">  </span><span class="n">labels</span><span class="o">$</span><span class="nf">save</span><span class="p">()</span>
<span class="linenos">23</span><span class="w">  </span><span class="n">labels</span><span class="o">$</span><span class="nf">close</span><span class="p">()</span>
<span class="linenos">24</span><span class="p">}</span>
</pre></div>
</div>
<p>Then we can close the logfile and we are done. The whole file is available <a class="reference download internal" download="" href="_downloads/719a69035a9d63fbc06049e8b9799dcd/cumulativeChange.R"><code class="xref download docutils literal notranslate"><span class="pre">here</span></code></a></p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># DONE</span>
<span class="linenos">2</span><span class="n">self</span><span class="o">$</span><span class="nf">writeLog</span><span class="p">(</span><span class="s">&quot;Done&quot;</span><span class="p">)</span>
<span class="linenos">3</span><span class="n">self</span><span class="o">$</span><span class="nf">exitLog</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="testing-the-module">
<h3>Testing the module<a class="headerlink" href="#testing-the-module" title="Permalink to this heading">#</a></h3>
<p>The module can be tested from R Markdown. you can place a <cite>browser()</cite> command anywhere in the <cite>run</cite> function for debugging purposes. We must define the function parameters as a <cite>named list</cite>. Functions can then be run with <cite>cciaObj$runTask()</cite>. The function name must be passed along with the parameters, the running environment, whether it should run in place as a separate process as well as the task ID number that will be assigned to the running task. Processes can run in parallel when using separate processes - just make sure that each process has a unique task ID otherwise they might interfere with each other.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># run task</span>
<span class="linenos"> 2</span><span class="n">funParams</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span>
<span class="linenos"> 3</span><span class="w">  </span><span class="n">popType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;live&quot;</span><span class="p">,</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="n">pops</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;OTI/tracked&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;P14/tracked&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;gBT/tracked&quot;</span><span class="p">),</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="n">sumLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8</span>
<span class="linenos"> 6</span><span class="p">)</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="c1"># run task</span>
<span class="linenos"> 9</span><span class="n">task</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cciaObj</span><span class="o">$</span><span class="nf">runTask</span><span class="p">(</span>
<span class="linenos">10</span><span class="w">  </span><span class="n">funName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;behaviourAnalysis.cumulativeChange&quot;</span><span class="p">,</span>
<span class="linenos">11</span><span class="w">  </span><span class="n">funParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">funParams</span><span class="p">,</span>
<span class="linenos">12</span><span class="w">  </span><span class="n">env</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;local&quot;</span><span class="p">,</span>
<span class="linenos">13</span><span class="w">  </span><span class="n">runInplace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span>
<span class="linenos">14</span><span class="w">  </span><span class="n">taskID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
<span class="linenos">15</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="add-the-module-to-the-gui">
<h3>Add the module to the GUI<a class="headerlink" href="#add-the-module-to-the-gui" title="Permalink to this heading">#</a></h3>
<p>We must create a <cite>JSON</cite> file to integrate the function and expose the parameters in the main GUI. Start editing the <cite>cumulativeChange.json</cite> file that we created earlier within the <cite>inputDefinitions</cite> folder. The backbone of the input definition looks like the following. In <cite>fun</cite> we must provide the function name <cite>cumulativeChange</cite> and give it a category under which it will be listed in the function selection and a label. Functions can run locally or on an <cite>HPC</cite> system. For our use case we focus on the <cite>local</cite> environment only. This format was inspired by <a class="reference external" href="https://docs.arivis.cloud/create-modules/hello-world">Zeiss’ module specification</a>.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="p">{</span>
<span class="linenos"> 2</span><span class="w">  </span><span class="nt">&quot;fun&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 3</span><span class="w">    </span><span class="nt">&quot;cumulativeChange&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 4</span><span class="w">      </span><span class="nt">&quot;category&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Module functions&quot;</span><span class="p">,</span>
<span class="linenos"> 5</span><span class="w">      </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Cumulative change&quot;</span><span class="p">,</span>
<span class="linenos"> 6</span><span class="w">      </span><span class="nt">&quot;env&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;local&quot;</span><span class="p">]</span>
<span class="linenos"> 7</span><span class="w">    </span><span class="p">}</span>
<span class="linenos"> 8</span><span class="w">  </span><span class="p">},</span>
<span class="linenos"> 9</span><span class="w">  </span><span class="nt">&quot;spec&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">10</span><span class="w">    </span><span class="nt">&quot;inputs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">11</span><span class="w">    </span><span class="p">},</span>
<span class="linenos">12</span><span class="w">    </span><span class="nt">&quot;outputs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<span class="linenos">13</span><span class="w">  </span><span class="p">},</span>
<span class="linenos">14</span><span class="w">  </span><span class="nt">&quot;ui&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">15</span><span class="w">    </span><span class="nt">&quot;inputs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">16</span><span class="w">    </span><span class="p">},</span>
<span class="linenos">17</span><span class="w">    </span><span class="nt">&quot;outputs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<span class="linenos">18</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">19</span><span class="p">}</span>
</pre></div>
</div>
<p>In <cite>spec</cite> we define the data types for each parameter. Populations are a <cite>list</cite> and the length of the summation is an <cite>integer</cite> with min, max and default values.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nt">&quot;spec&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 2</span><span class="w">  </span><span class="nt">&quot;inputs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 3</span><span class="w">    </span><span class="nt">&quot;pops&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 4</span><span class="w">      </span><span class="nt">&quot;type:list&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<span class="linenos"> 5</span><span class="w">    </span><span class="p">},</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="nt">&quot;sumLength&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 7</span><span class="w">      </span><span class="nt">&quot;type:integer&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 8</span><span class="w">        </span><span class="nt">&quot;min&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="linenos"> 9</span><span class="w">        </span><span class="nt">&quot;max&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span>
<span class="linenos">10</span><span class="w">        </span><span class="nt">&quot;default&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span>
<span class="linenos">11</span><span class="w">      </span><span class="p">}</span>
<span class="linenos">12</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">13</span><span class="w">  </span><span class="p">},</span>
<span class="linenos">14</span><span class="w">  </span><span class="nt">&quot;outputs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<span class="linenos">15</span><span class="p">},</span>
</pre></div>
</div>
<p>In <cite>ui</cite> we define the GUI elements for the parameters. For populations, there is a predefined population selection widget that we can utilise. For the summation length we can use a slider. Here is a list of all supported widgets: <a class="reference internal" href="input_widget_types.html#input-widget-types"><span class="std std-ref">Input widget types</span></a>. The complete JSON file is <a class="reference download internal" download="" href="_downloads/f246ced195c183aa063b91300c2da394/cumulativeChange.json"><code class="xref download docutils literal notranslate"><span class="pre">here</span></code></a>.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nt">&quot;ui&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 2</span><span class="w">  </span><span class="nt">&quot;inputs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 3</span><span class="w">    </span><span class="nt">&quot;pops&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 4</span><span class="w">      </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="linenos"> 5</span><span class="w">      </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Populations&quot;</span><span class="p">,</span>
<span class="linenos"> 6</span><span class="w">      </span><span class="nt">&quot;widget:popSelection&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 7</span><span class="w">        </span><span class="nt">&quot;size&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="linenos"> 8</span><span class="w">        </span><span class="nt">&quot;multiple&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="linenos"> 9</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">10</span><span class="w">  </span><span class="p">},</span>
<span class="linenos">11</span><span class="w">  </span><span class="nt">&quot;sumLength&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">12</span><span class="w">    </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="linenos">13</span><span class="w">      </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Summation length&quot;</span><span class="p">,</span>
<span class="linenos">14</span><span class="w">      </span><span class="nt">&quot;widget:slider&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">15</span><span class="w">        </span><span class="nt">&quot;step&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="linenos">16</span><span class="w">      </span><span class="p">}</span>
<span class="linenos">17</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">18</span><span class="w">  </span><span class="p">},</span>
<span class="linenos">19</span><span class="w">  </span><span class="nt">&quot;outputs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<span class="linenos">20</span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="comparing-the-output-of-the-function">
<h3>Comparing the output of the function<a class="headerlink" href="#comparing-the-output-of-the-function" title="Permalink to this heading">#</a></h3>
<p>We can now use this new function to compare its impact on the behaviour extraction from cells. In the GUI under <cite>Cell Behaviour</cite>, select our newly created <cite>Cumulative change</cite> function. Select all tracked populations and set the <cite>summation length</cite> to 8. Run the function.</p>
<a class="reference internal image-reference" href="_images/create_module_fun_in_gui.png"><img alt="_images/create_module_fun_in_gui.png" src="_images/create_module_fun_in_gui.png" style="width: 48%;" /></a>
<p>Then extract 3 <cite>HMM</cite> states with the default <cite>live.cell.speed</cite> and <cite>live.cell.angle</cite> and our new measurements of <cite>live.cell.sumDirChange</cite> and <cite>live.cell.sumSpeedChange</cite>.</p>
<a class="reference internal image-reference" href="_images/create_module_hmm_default.png"><img alt="_images/create_module_hmm_default.png" src="_images/create_module_hmm_default.png" style="width: 48%;" /></a>
<a class="reference internal image-reference" href="_images/create_module_hmm_new.png"><img alt="_images/create_module_hmm_new.png" src="_images/create_module_hmm_new.png" style="width: 48%;" /></a>
<p>Now you can open up the image and compare the <cite>HMM state</cite> results from these two approaches. The behaviour extracted with our new measurements is a bit coarser than the default one and might be useful for certain settings where you want to simplify results. We can use a <cite>viridis</cite> scale to look at the outcome of the <cite>HMM states</cite> (yellow = 3, green = 2, blue = 1, purple = No state). At the same time we can check the properties of these individual states in the shiny app.</p>
<p><cite>HMM states</cite> using the default <cite>speed</cite> and <cite>angle</cite> measurements.</p>
<a class="reference internal image-reference" href="_images/create_module_default_HMM.png"><img alt="_images/create_module_default_HMM.png" src="_images/create_module_default_HMM.png" style="width: 100%;" /></a>
<p><cite>HMM states</cite> using the rom our modified version.</p>
<a class="reference internal image-reference" href="_images/create_module_new_HMM.png"><img alt="_images/create_module_new_HMM.png" src="_images/create_module_new_HMM.png" style="width: 100%;" /></a>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="module_function_names.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Module function names</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="access_data_rmarkdown.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Access data in RMarkdown</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, Dominik Schienstock
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Create custom module</a><ul>
<li><a class="reference internal" href="#live-cell-imaging">Live cell imaging</a><ul>
<li><a class="reference internal" href="#r-markdown">R Markdown</a></li>
<li><a class="reference internal" href="#creating-a-module">Creating a module</a></li>
<li><a class="reference internal" href="#testing-the-module">Testing the module</a></li>
<li><a class="reference internal" href="#add-the-module-to-the-gui">Add the module to the GUI</a></li>
<li><a class="reference internal" href="#comparing-the-output-of-the-function">Comparing the output of the function</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=e031e9a9"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="_static/scripts/furo.js?v=32e29ea5"></script>
    </body>
</html>